{"pageProps":{"postData":{"id":"2016-10-09-line-bot.html","contentHtml":"<p>Line ได้ออก API สำหรับ Line @ และ Line Official มาได้สักพักนึงแล้วโดยใช้ชื่อว่า <a href=\"https://developers.line.me/messaging-api/overview\">Messaging Api</a> ซึ่งวันนี้เพิ่งมีโอกาสได้ลองเล่น API แบบจริงจังเลยมาเขียนบล็อกแชร์ประสบการณ์การใช้งาน API ของ Line ในการสร้าง Chat Bot แบบขำๆขึ้นมา  </p>\n<p><strong>สิ่งที่ต้องการในการสร้าง Bot</strong>  </p>\n<p>- Server 1 ตัว (ใช้ Ubuntu 14.04)  </p>\n<ul>\n<li>Nginx  (ใช้อะไรก็ได้แล้วแต่ถนัด)<br>\n- HTTPS ที่ valid cert อันนี้ต้องมีไม่งั้น<strong>ใช้ไม่ได้</strong> ในที่นี้ใช้ <a href=\"http://letsencrypt/\">Let's Encrypt</a> (ลองใช้ Cloudflare ที่ใช้ค่า - Default แล้วโดนบล็อกข้อมูลที่ส่งมาจาก Line เลยขี้เกียจหาวิธีแก้)<br>\n- PHP 5<br>\n- Python 3<br>\n- <a href=\"https://github.com/gunthercox/ChatterBot\">ChatterBot</a> (เอาไว้สร้าง Bot Chat)<br>\n- <a href=\"https://www.mongodb.com/\">MongoDB</a> (เอาไว้เก็บข้อมูลของ ChatterBot)<br>\n- <a href=\"https://github.com/kittinan/Sample-Line-Bot\">Sample-Line-Bot</a> (<a href=\"https://github.com/kittinan/Sample-Line-Bot\">https://github.com/kittinan/Sample-Line-Bot</a>)<br>\n</li>\n</ul>\n<p>ติดตั้ง Nginx, php และ config https ไว้ให้พร้อมใช้งาน <strong>Line Messaging API Architecture</strong>  </p>\n<p>ขออนุญาติก็อบรูปใน <a href=\"https://developers.line.me/messaging-api/overview\">Line Developer</a> มาให้ดู ซึ่งการทำงานก็ไม่มีไรมาก<br>\nเมื่อผู้ใช้ส่งข้อความมาที่ Line @ เรา Line ก็จะส่งข้อความนั้นมายัง Server ที่เราเซตเอาไว้  </p>\n<p><a href=\"https://4.bp.blogspot.com/-MjV8_HwH8KU/V_oxD8HITUI/AAAAAAAAkaI/6Zdel4AHUGg19kHssbvRjy0rVidN0ydCACLcB/s1600/bottrial-fig1.png\"><img src=\"https://4.bp.blogspot.com/-MjV8_HwH8KU/V_oxD8HITUI/AAAAAAAAkaI/6Zdel4AHUGg19kHssbvRjy0rVidN0ydCACLcB/s640/bottrial-fig1.png\"></a>  </p>\n<p><strong>สมัครใช้งาน Line Messaging API</strong>  </p>\n<p>ตาม Link นี้เลย <a href=\"https://developers.line.me/messaging-api/getting-started\">https://developers.line.me/messaging-api/getting-started</a> ค่อยๆอ่าน แล้วทำตามอย่าข้ามขั้นตอนเด็ดขาด ไม่งั้นปวดหัวสุดๆ  </p>\n<p><strong>สร้าง Chat Bot ด้วย ChatterBot</strong><br>\n<strong>Install MongoDB</strong>  </p>\n<p>วิธีการตาม Link นี้เลย <a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-mongodb-on-ubuntu-14-04\">https://www.digitalocean.com/community/tutorials/how-to-install-mongodb-on-ubuntu-14-04</a>  </p>\n<blockquote>\n<p>sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10<br>\nsudo echo \"deb <a href=\"http://repo.mongodb.org/apt/ubuntu\">http://repo.mongodb.org/apt/ubuntu</a> \"$(lsb_release -sc)\"/mongodb-org/3.0 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.0.list<br>\nsudo apt-get update<br>\nsudo apt-get install -y mongodb-org</p>\n</blockquote>\n<p>เสร็จสิ้นการลง MongoDB  </p>\n<p><strong>Install Python 3</strong>  </p>\n<p>ใน Ubuntu 14.04 นั้นลง Python 3 มาไว้อยู่แล้ว โดยแค่ลงเพิ่มอีก 2 package คือ python pip กับ python levenshtein  </p>\n<blockquote>\n<p>sudo apt-get install python3-pip python3-levenshtein python3-nltk python3-setuptools</p>\n</blockquote>\n<p>Install ChatterBot ผ่าน python pip  </p>\n<blockquote>\n<p>sudo pip3 install chatterbot</p>\n</blockquote>\n<blockquote>\n<p>sudo python3 -m nltk.downloader -d /usr/local/share/nltk_data brown movie_reviews conll2000 punkt averaged_perceptron_tagger</p>\n</blockquote>\n<p>เมื่อลง Package ที่ต้องการต่างๆเรียบร้อยแล้วให้ clone <strong><a href=\"https://github.com/kittinan/Sample-Line-Bot\">https://github.com/kittinan/Sample-Line-Bot</a></strong> มายังเครื่อง เพื่อที่เราจะเริ่มทำการ train bot ให้ตอบแชทได้  </p>\n<p>เมื่อ clone มาเสร็จแล้วให้ไปยัง folder python แล้วรัน  </p>\n<blockquote>\n<p>python3 trainer.py sample_conversation.json</p>\n</blockquote>\n<p>โดย <a href=\"https://github.com/kittinan/Sample-Line-Bot/blob/master/python/sample_conversation.json\">sample_conversation.json</a> นั้นเป็นตัวอย่างข้อมูลการสนทนา ถาม-ตอบ ซึ่งอยู่ใน format json array โดยส่วนตัวผมใช้ข้อมูลการ Chat กับเพื่อนใน Facebook ในการ train model ของ chat bot  </p>\n<p><a href=\"https://3.bp.blogspot.com/-uYWCGce28Vw/V_pGrfvXU8I/AAAAAAAAkao/C2yG3tYdlQoVoWQt2mnkj2OmvuN1SmW5ACLcB/s1600/Screenshot-null%2540null%253A%2B%257E-git-Sample-Line-Bot-python-1.png\"><img src=\"https://3.bp.blogspot.com/-uYWCGce28Vw/V_pGrfvXU8I/AAAAAAAAkao/C2yG3tYdlQoVoWQt2mnkj2OmvuN1SmW5ACLcB/s640/Screenshot-null%2540null%253A%2B%257E-git-Sample-Line-Bot-python-1.png\"></a><br>\nเมื่อ train model เสร็จแล้วให้ทดสอบว่า chat bot ทำงานได้ถูกต้องโดยการรัน  </p>\n<blockquote>\n<p>python3 chat.py \"ดีครับ\"<br>\npython3 chat.py \"ชื่อไร\"</p>\n</blockquote>\n<p>Bot ก็จะตอบมาดังภาพ  </p>\n<p><a href=\"https://1.bp.blogspot.com/-ncjT6A2NXYc/V_pGzKWbuFI/AAAAAAAAkas/h0nU7cx-Gx04aK61TgG5ZMUUl7TdgzRuwCLcB/s1600/Screenshot-null%2540null%253A%2B%257E-git-Sample-Line-Bot-python-2.png\"><img src=\"https://1.bp.blogspot.com/-ncjT6A2NXYc/V_pGzKWbuFI/AAAAAAAAkas/h0nU7cx-Gx04aK61TgG5ZMUUl7TdgzRuwCLcB/s640/Screenshot-null%2540null%253A%2B%257E-git-Sample-Line-Bot-python-2.png\"></a><br>\nดูรายละเอียด <a href=\"https://github.com/gunthercox/ChatterBot\">ChatterBot</a>  เพิ่มเติม ได้ที่ <a href=\"http://chatterbot.readthedocs.io/en/stable/\">http://chatterbot.readthedocs.io/en/stable/</a>  </p>\n<p><strong>ประกอบร่าง  Line API กับ ChatterBot</strong><br>\nเข้าไป <a href=\"https://business.line.me/en/\">Line Business Center</a> แล้วเข้า Messaging API Developer<br>\n<a href=\"https://2.bp.blogspot.com/-EMwg6eCGYRs/V_pT0eZoTOI/AAAAAAAAkck/M2fLLlwxNOgLSBx6MBWLfbCk7n7xwxJaACLcB/s1600/Screenshot%2Bfrom%2B2016-10-09%2B21%253A26%253A09.png\"><img src=\"https://2.bp.blogspot.com/-EMwg6eCGYRs/V_pT0eZoTOI/AAAAAAAAkck/M2fLLlwxNOgLSBx6MBWLfbCk7n7xwxJaACLcB/s1600/Screenshot%2Bfrom%2B2016-10-09%2B21%253A26%253A09.png\"></a>  </p>\n<p>ตั้งค่า Webhook URL ให้ชี้มายัง Domain Server ของเรา (Line บังคับให้ใช้ได้เฉพาะ https ที่  valid เท่านั้น) ดังภาพ  </p>\n<p><a href=\"https://3.bp.blogspot.com/-Fjk9ZdBdWS0/V_pBqJ4SC_I/AAAAAAAAkaY/Eo-E4Z6MmbUcYxHSBdDliIiHwEDbP7KVQCLcB/s1600/Screenshot%2Bfrom%2B2016-10-09%2B20%253A06%253A56.png\"><img src=\"https://3.bp.blogspot.com/-Fjk9ZdBdWS0/V_pBqJ4SC_I/AAAAAAAAkaY/Eo-E4Z6MmbUcYxHSBdDliIiHwEDbP7KVQCLcB/s640/Screenshot%2Bfrom%2B2016-10-09%2B20%253A06%253A56.png\"></a>แล้ว Copy Channel Access Token มาใส่ในไฟล์ config.yml  </p>\n<p>แล้ว Install Dependencies ของ code php ให้เรียบร้อย ผ่านทาง <a href=\"https://getcomposer.org/\">composer</a>  </p>\n<blockquote>\n<p>composer install</p>\n</blockquote>\n<p>ลองไปคุยกับ bot ใน Line  bot ก็จะตอบข้อความเราตาม model ที่ train ไว้ดังภาพ  </p>\n<p><a href=\"https://1.bp.blogspot.com/-3oce6rQO5Ek/V_pL8RBcBxI/AAAAAAAAkb4/7gjVVgeeDSwobnsIC7tgQUYwFp_RCX1qwCLcB/s1600/Screenshot_20161009-205108.png\"><img src=\"https://1.bp.blogspot.com/-3oce6rQO5Ek/V_pL8RBcBxI/AAAAAAAAkb4/7gjVVgeeDSwobnsIC7tgQUYwFp_RCX1qwCLcB/s640/Screenshot_20161009-205108.png\"></a>  </p>\n<p>ปล.  </p>\n<ul>\n<li>กราบขออภัยที่ไม่ได้ลงลึกในรายละเอียดการติดตั้งในส่วนต่างๆ  </li>\n<li>คราวหน้าเราจะมาสร้าง model ของ chatbot จาก ข้อความที่เราเคย chat กับเพื่อนใน facebook กัน  </li>\n</ul>\n","title":"ทดลองสร้าง Line @ Bot แบบมั่วๆ","date":"2016-10-09 21:21:00"}},"__N_SSG":true}